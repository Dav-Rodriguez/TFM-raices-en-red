<div class="explore-container">
  <header class="explore-hero">
    <div class="overlay">
      <h1>Encuentra proyectos donde tu talento genere impacto</h1>
    </div>
  </header>

  <div class="content-padding">
    <section class="filter-system">
      <div class="filter-group">
        <label>Filtrar por Grupos Prioritarios:</label>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Seleccionar grupos</mat-label>
          <mat-select
            [value]="selectedGroups"
            (selectionChange)="onGroupSelect($event)"
            multiple
          >
            <mat-option *ngFor="let group of groupsList" [value]="group">
              {{ group }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div class="selected-chips-container" *ngIf="selectedGroups.length > 0">
          <mat-chip-row
            *ngFor="let group of selectedGroups"
            (removed)="toggleGroup(group)"
            class="custom-chip"
          >
            {{ group }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip-row>
        </div>
      </div>

      <div class="filter-group">
        <label>Categoría Técnica (SbN):</label>
        <div class="category-grid">
          <div
            class="cat-card"
            [class.active]="selectedCategory === 'Agua'"
            (click)="setCategory('Agua')"
          >
            <mat-icon>opacity</mat-icon><span>Agua</span>
          </div>

          <div
            class="cat-card"
            [class.active]="selectedCategory === 'Ambiente'"
            (click)="setCategory('Ambiente')"
          >
            <mat-icon>eco</mat-icon><span>Ambiente</span>
          </div>

          <div
            class="cat-card"
            [class.active]="selectedCategory === 'Alimentación'"
            (click)="setCategory('Alimentación')"
          >
            <mat-icon>restaurant</mat-icon><span>Alimentación</span>
          </div>

          <div
            class="cat-card"
            [class.active]="selectedCategory === 'Hábitat'"
            (click)="setCategory('Hábitat')"
          >
            <mat-icon>home</mat-icon><span>Hábitat</span>
          </div>

          <div
            class="cat-card"
            [class.active]="selectedCategory === 'Riesgos Climáticos'"
            (click)="setCategory('Riesgos Climáticos')"
          >
            <mat-icon>thunderstorm</mat-icon><span>Riesgos Climáticos</span>
          </div>

          <div
            class="cat-card"
            [class.active]="selectedCategory === 'Fauna'"
            (click)="setCategory('Fauna')"
          >
            <mat-icon>pets</mat-icon><span>Fauna</span>
          </div>
        </div>
      </div>

      <div class="reset-container">
        <button
          mat-button
          color="warn"
          (click)="resetFilters()"
          *ngIf="selectedCategory || selectedGroups.length > 0"
        >
          <mat-icon>restart_alt</mat-icon> Limpiar todos los filtros
        </button>
      </div>
    </section>

    <section class="results-feed">
      <div class="section-header">
        <h4>Proyectos Encontrados ({{ filteredProblems.length }})</h4>
      </div>

      <div class="no-results" *ngIf="filteredProblems.length === 0">
        <mat-icon>search_off</mat-icon>
        <p>No hay problemáticas para los filtros seleccionados.</p>
        <button mat-stroked-button color="primary" (click)="resetFilters()">
          Ver todo
        </button>
      </div>

      <mat-card
        class="problem-item-card"
        *ngFor="let prob of filteredProblems"
        [routerLink]="['/problem-detail', prob._id]"
      >
        <div class="card-horizontal-layout">
          <img [src]="prob.imageUrl || 'assets/hero-bg.jpg'" class="thumb" />
          <div class="info">
            <h3>{{ prob.title }}</h3>
            <p class="community">
              <mat-icon>location_on</mat-icon>
              {{ prob.city || "Ubicación no especificada" }}
            </p>
            <p class="excerpt">{{ prob.description | slice : 0 : 140 }}...</p>
            <div class="tags">
              <span class="tag-sbn">{{ prob.categoryProject }}</span>
            </div>
          </div>
        </div>
      </mat-card>
    </section>
  </div>
</div>
